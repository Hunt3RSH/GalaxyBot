const express = require('express');
const tmi = require('tmi.js');

// Ð†Ð½Ñ–Ñ†Ñ–Ð°Ð»Ñ–Ð·Ð°Ñ†Ñ–Ñ Ð´Ð¾Ð´Ð°Ñ‚ÐºÑƒ Express
const app = express();

// Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÑŽÑ”Ð¼Ð¾ Ð¿Ð¾Ñ€Ñ‚ Ñ–Ð· Ð·Ð¼Ñ–Ð½Ð½Ð¾Ñ— ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ð° (Render Ð½Ð°Ð´Ð°Ñ” Ð¿Ð¾Ñ€Ñ‚ Ñ‡ÐµÑ€ÐµÐ· process.env.PORT)
// Ð°Ð±Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ”Ð¼Ð¾ 3000 Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÑƒ
const port = process.env.PORT || 3000;

// ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸ Ð´Ð»Ñ Ð±Ð¾Ñ‚Ð°
const client = new tmi.Client({
    identity: {
        username: 'hunt3rsbot', // Ð†Ð¼'Ñ Ð²Ð°ÑˆÐ¾Ð³Ð¾ Ð±Ð¾Ñ‚Ð°
        password: 'oauth:oxsd08wgp1d6etrg1jhx9zo98d4i9n' // OAuth-Ñ‚Ð¾ÐºÐµÐ½ Ð±Ð¾Ñ‚Ð°
    },
    channels: ['hunt3r_wtf'] // Ð’Ð°Ñˆ ÐºÐ°Ð½Ð°Ð»
});

// ÐŸÑ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ Ð´Ð¾ Ñ‡Ð°Ñ‚Ñƒ Twitch
async function connectBot() {
    try {
        await client.connect();
        console.log('Bot connected to chat');
    } catch (err) {
        console.error('Error connecting bot:', err);
    }
}

// Ð’Ð¸ÐºÐ»Ð¸Ðº Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— Ð´Ð»Ñ Ð¿Ñ–Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð½Ñ
connectBot();

// ÐŸÐµÑ€Ñ–Ð¾Ð´Ð¸Ñ‡Ð½Ñ– Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ
const periodicMessages = [
  "ðŸ’¡ ÐÐµ Ð·Ð°Ð±ÑƒÐ²Ð°Ð¹Ñ‚Ðµ Ð¿Ð¸Ñ‚Ð¸ Ð²Ð¾Ð´Ñƒ Ð¿Ñ–Ð´ Ñ‡Ð°Ñ Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´Ñƒ ÑÑ‚Ñ€Ñ–Ð¼Ñƒ!",
  "ðŸ”¥ ÐŸÑ–Ð´Ð¿Ð¸ÑÑƒÐ¹Ñ‚ÐµÑÑŒ Ð½Ð° ÐºÐ°Ð½Ð°Ð», Ñ‰Ð¾Ð± Ð½Ðµ Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ð½Ð¾Ð²Ñ– ÑÑ‚Ñ€Ñ–Ð¼Ð¸!",
  "ðŸ’¬ Ð¡Ñ‚Ð°Ð²Ñ‚Ðµ ÑÐ²Ð¾Ñ— Ð·Ð°Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð² Ñ‡Ð°Ñ‚Ñ– â€” ÑÑ‚Ñ€Ñ–Ð¼ÐµÑ€ Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–ÑÑ‚Ð¸!",
  "ðŸŽ® ÐŸÑ–Ð´Ñ‚Ñ€Ð¸Ð¼Ð°Ð¹Ñ‚Ðµ ÑÑ‚Ñ€Ñ–Ð¼ÐµÑ€a, Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑŽÑ‡Ð¸ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ !Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÐ°",
  "ðŸ“¢ ÐŸÑ€Ð¸Ñ”Ð´Ð½ÑƒÐ¹Ñ‚ÐµÑÑŒ Ð´Ð¾ Ð½Ð°ÑˆÐ¾Ð³Ð¾ Discord: https://discord.gg/CSMdbPCHXf",
  "ðŸŽ¥ Ð—Ð°Ð¿Ñ€Ð¾ÑÑ–Ñ‚ÑŒ Ð´Ñ€ÑƒÐ·Ñ–Ð² Ð½Ð° ÑÑ‚Ñ€Ñ–Ð¼, Ñ‡Ð¸Ð¼ Ð½Ð°Ñ Ð±Ñ–Ð»ÑŒÑˆÐµ â€” Ñ‚Ð¸Ð¼ Ñ†Ñ–ÐºÐ°Ð²Ñ–ÑˆÐµ!",
  "ðŸ˜Š Ð—Ð°Ð»Ð¸ÑˆÐ°Ð¹Ñ‚Ðµ Ð²Ð°ÑˆÑ– ÐºÐ¾Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ñ– Ñ‚Ð° Ð´ÑƒÐ¼ÐºÐ¸ Ñƒ Ñ‡Ð°Ñ‚Ñ– â€” Ñ†Ðµ Ð´Ð¾Ð¿Ð¾Ð¼Ð°Ð³Ð°Ñ” ÑÑ‚Ñ€Ñ–Ð¼ÐµÑ€Ñƒ!"
];

// Ð¤ÑƒÐ½ÐºÑ†Ñ–Ñ Ð´Ð»Ñ Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½Ñ Ð²Ð¸Ð¿Ð°Ð´ÐºÐ¾Ð²Ð¾Ð³Ð¾ Ñ–Ð½Ð´ÐµÐºÑÑƒ
function getRandomIndex(arrayLength) {
  return Math.floor(Math.random() * arrayLength);
}

// Ð†Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» Ð´Ð»Ñ Ð¿ÐµÑ€Ñ–Ð¾Ð´Ð¸Ñ‡Ð½Ð¸Ñ… Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½ÑŒ (10 Ñ…Ð²Ð¸Ð»Ð¸Ð½)
setInterval(() => {
  const randomIndex = getRandomIndex(periodicMessages.length);
  const message = periodicMessages[randomIndex];
  client.say("YourChannelName", message);  // Ð—Ð°Ð¼Ñ–Ð½Ñ–Ñ‚ÑŒ Ð½Ð° Ð²Ð°Ñˆ ÐºÐ°Ð½Ð°Ð»
}, 10 * 60 * 1000); // Ð†Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» Ñƒ Ð¼Ñ–Ð»Ñ–ÑÐµÐºÑƒÐ½Ð´Ð°Ñ…

// Ð ÐµÐ°ÐºÑ†Ñ–Ñ Ð½Ð° Ñ€ÐµÐ¹Ð´
client.on('raid', async (channel, username, viewers) => {
    console.log(`Raid from ${username} with ${viewers} viewers!`);
    await client.say(channel, `Ð”ÑÐºÑƒÑ”Ð¼Ð¾ Ð·Ð° Ñ€ÐµÐ¹Ð´, ${username}! ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€Ñ‚Ðµ ÐºÐ°Ð½Ð°Ð»: https://twitch.tv/${username}`);
});

// ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð½Ð° Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñƒ 'Ð«' Ð°Ð±Ð¾ 'Ñ‹'
client.on('message', async (channel, user, message, self) => {
    // Ð¯ÐºÑ‰Ð¾ Ñ†Ðµ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð²Ñ–Ð´ Ð±Ð¾Ñ‚Ð°, Ñ–Ð³Ð½Ð¾Ñ€ÑƒÑ”Ð¼Ð¾ Ð¹Ð¾Ð³Ð¾
    if (self) return;  // Ð†Ð³Ð½Ð¾Ñ€ÑƒÑ”Ð¼Ð¾ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ, ÑÐºÑ‰Ð¾ Ñ†Ðµ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð²Ñ–Ð´ Ð±Ð¾Ñ‚Ð°

    // ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð½Ð° Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñƒ 'Ð«' Ð°Ð±Ð¾ 'Ñ‹'
    if (message.includes("Ð«") || message.includes("Ñ‹")) {
        const warningMessage = `ÐŸÑ€Ð¸Ð²Ñ–Ñ‚, @${user["display-name"]}, Ñ‰Ð¾ Ð·Ð° Ð½ÐµÐ²Ñ–Ð´Ð¾Ð¼Ð¸Ð¹ ÑÐ¸Ð¼Ð²Ð¾Ð» 'Ð«' Ñƒ Ñ‚Ð²Ð¾Ñ”Ð¼Ñƒ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ–? ÐœÐ¾Ð¶Ðµ, Ñ†Ðµ Ð·Ð°ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ðµ Ð¿Ð¾ÑÐ»Ð°Ð½Ð½Ñ? Ð¢Ð¸ Ñ‚Ð¾Ñ‡Ð½Ð¾ Ñ…Ð¾Ñ‡ÐµÑˆ, Ñ‰Ð¾Ð± Ð¼Ð¸ Ð·Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ð»Ð¸?`;
        await client.say(channel, warningMessage);
    }

    // ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð½Ð° Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ ÑÐ»Ð¾Ð²Ð° "Ð´Ð°"
    const words = message.toLowerCase().split(/\s+/);
    if (words.includes("Ð´Ð°")) {
        const warningMessage = `ÐŸÐ¾Ð¿Ð°Ð²ÑÑ @${user["display-name"]}, ÐžÐ³Ð¾, Ñ‚Ð¸ ÑÐºÐ°Ð·Ð°Ð² 'Ð´Ð°'? Ð¯ Ð½Ð°Ð²Ñ–Ñ‚ÑŒ Ð½Ðµ Ð·Ð½Ð°ÑŽ, ÑÐº Ð· Ñ†Ð¸Ð¼ Ð¶Ð¸Ñ‚Ð¸. ðŸ˜± Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð¾Ð±Ð¸Ñ€Ð°Ð¹ ÑÐ»Ð¾Ð²Ð° Ð¼ÑƒÐ´Ñ€Ñ–ÑˆÐµ, Ñ‰Ð¾Ð± Ð½Ðµ Ð²Ð¿Ð°ÑÑ‚Ð¸ Ð² Ð³Ñ€Ñ–Ñ…!`;
        await client.say(channel, warningMessage);
    }
});

// Ð—Ð°Ð¿ÑƒÑÐº Express ÑÐµÑ€Ð²ÐµÑ€Ñƒ Ð½Ð° Ð·Ð°Ð´Ð°Ð½Ð¾Ð¼Ñƒ Ð¿Ð¾Ñ€Ñ‚Ñ–
app.listen(port, () => {
    console.log(`Server running on port ${port}`);
});
